? build
Index: ChangeLog
===================================================================
RCS file: /usr/local/CVS/libuser/ChangeLog,v
retrieving revision 1.143
retrieving revision 1.144
diff -u -r1.143 -r1.144
--- ChangeLog	25 Oct 2007 06:36:56 -0000	1.143
+++ ChangeLog	30 Oct 2007 22:23:33 -0000	1.144
@@ -1,3 +1,8 @@
+2007-10-30  Miloslav Trmač  <mitr@redhat.com>
+
+	* lib/util.c (lu_util_fscreate_restore) [WITH_SELINUX]: Fix use of
+	uninitialized data when SELinux is disabled.
+
 2007-10-25  Miloslav Trmač  <mitr@redhat.com>
 
 	* configure.in: Version 0.56.6.
Index: lib/util.c
===================================================================
RCS file: /usr/local/CVS/libuser/lib/util.c,v
retrieving revision 1.16
retrieving revision 1.17
diff -u -r1.16 -r1.17
--- lib/util.c	25 Oct 2007 05:48:04 -0000	1.16
+++ lib/util.c	30 Oct 2007 22:23:33 -0000	1.17
@@ -613,10 +613,11 @@
 void
 lu_util_fscreate_restore(security_context_t ctx)
 {
-	/* Don't check is_selinux_enabled(), we ignore errors anyway */
-	(void)setfscreatecon(ctx);
-	if (ctx)
-		freecon(ctx);
+	if (is_selinux_enabled() > 0) {
+		(void)setfscreatecon(ctx);
+		if (ctx)
+			freecon(ctx);
+	}
 }
 
 /* Set fscreate context from context of file. */
